importScripts("../lib/crop.min.js");var getGrasslandCb=function(t){var e=t.sites,s=e.length,o={},i=t.cutThreshhold,r=(t.hayShare,t.startYear);return function(t,e,a,l){for(var C,n,u,d,h,f,g,p=parseInt(e.split("-")[1],10),M=parseInt(e.split("-")[0],10),y=0;s>y;y++)if(C=a[y],n=C.isCropPlanted())if(u=C.cropGrowth(),r>M)C.getIsVegPeriod()&&p>4&&10>p&&u.shootBiomass()-800>1500&&u.harvestShootBiomass(u.shootBiomass()-800);else if(void 0===o[M]&&(o[M]={firstCut:{"yield":0,OM:0,OMD:0,CP:0,CF:0},lateCut:{"yield":0,OM:0,OMD:0,CP:0,CF:0}}),C.getIsVegPeriod()&&u.shootBiomass()-800>i){if(yield=u.harvestShootBiomass(u.shootBiomass()-800),g=u.shootOrganicMatterDigestibility(),d=u.shootOrganicMatterContent(),h=u.shootCrudeProteinContent(),f=u.shootCrudeFibreContent(),0===o[M].firstCut["yield"])o[M].firstCut["yield"]=yield,o[M].firstCut.OM=d,o[M].firstCut.OMD=g,o[M].firstCut.CP=h,o[M].firstCut.CF=f;else{var O=o[M].lateCut["yield"]+yield,c=o[M].lateCut["yield"]/O,P=yield/O;o[M].lateCut["yield"]=O,o[M].lateCut.OM=o[M].lateCut.OM*c+d*P,o[M].lateCut.OMD=o[M].lateCut.OMD*c+g*P,o[M].lateCut.CP=o[M].lateCut.CP*c+h*P,o[M].lateCut.CF=o[M].lateCut.CF*c+f*P}o[e]=yield}var m=t/a.weather.noOfStepsPossible()*100|0;m%10===0&&postMessage({done:!1,progress:t/a.weather.noOfStepsPossible()*100}),l&&postMessage({done:!0,grasslandDM:o})}};onmessage=function(t){var e=t.data,s=new crop.Configuration(e.weather,e.debug,e.verbose,getGrasslandCb(e.grassland));s.run(e.cropConfig.simulation,e.cropConfig.siteAndProd)};